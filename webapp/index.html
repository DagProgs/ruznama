<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="–í—Ä–µ–º–µ–Ω–∞ –Ω–∞–º–∞–∑–æ–≤ –æ–Ω–ª–∞–π–Ω ‚Äî –†—É–∑–Ω–∞–º–∞" />
  <title>üïå –†—É–∑–Ω–∞–º–∞ ‚Äî –í—Ä–µ–º–µ–Ω–∞ –Ω–∞–º–∞–∑–æ–≤</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Amiri&display=swap" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background 0.5s ease, color 0.5s ease, transform 0.2s ease;
    }
    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.7;
      min-height: 100vh;
      position: relative;
      padding-bottom: 60px;
    }
    body.light {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #212529;
    }
    body.dark {
      background: linear-gradient(135deg, #0a1128 0%, #111a3a 100%);
      color: #e0e4f0;
    }
    body.dark::before {
      content: "";
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-image: 
        radial-gradient(1px 1px at 20px 30px, rgba(160, 216, 241, 0.4), transparent),
        radial-gradient(1px 1px at 100px 120px, rgba(135, 196, 224, 0.3), transparent);
      z-index: -1;
      pointer-events: none;
      animation: stars 50s linear infinite;
    }
    @keyframes stars {
      0% { background-position: 0 0; }
      100% { background-position: 500px 500px; }
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
    }
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #0d6efd;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 10;
      border: 2px solid white;
    }
    body.dark .theme-toggle {
      background: #4fd1c5;
    }
    .logo {
      font-size: 3.8rem;
      text-align: center;
      margin-bottom: 16px;
    }
    body.light .logo { color: #0d6efd; }
    body.dark .logo { color: #4fd1c5; }
    h1 {
      text-align: center;
      font-size: 2.4rem;
      margin-bottom: 8px;
      font-weight: 600;
    }
    body.light h1 { color: #0d6efd; }
    body.dark h1 { color: #4fd1c5; }
    .subtitle {
      text-align: center;
      font-size: 1.1rem;
      margin-bottom: 30px;
      opacity: 0.8;
    }
    body.light .subtitle { color: #495057; }
    body.dark .subtitle { color: #a0d8f1; }
    .search-box {
      display: flex;
      gap: 10px;
      margin: 30px 0;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      position: relative;
    }
    .search-box input {
      flex: 1;
      padding: 14px;
      border: 2px solid #0d6efd;
      border-radius: 12px;
      font-size: 1rem;
      outline: none;
      background: white;
      color: #212529;
    }
    body.dark .search-box input {
      background: #1e2a47;
      color: #e0e4f0;
      border-color: #4fd1c5;
    }
    .search-box input:focus {
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
    }
    body.dark .search-box input:focus {
      box-shadow: 0 0 0 3px rgba(79, 209, 197, 0.3);
    }
    .search-box button {
      padding: 0 20px;
      background: #0d6efd;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
    }
    body.dark .search-box button {
      background: #4fd1c5;
      color: #0a1128;
    }
    .search-box button:hover {
      transform: translateY(-2px);
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è */
    .suggestions {
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      max-height: 300px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }
    body.dark .suggestions {
      background: #1e2a47;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    .suggestion-item {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      font-size: 0.95rem;
    }
    body.dark .suggestion-item {
      color: #e0e4f0;
      border-bottom: 1px solid #334155;
    }
    .suggestion-item:last-child {
      border-bottom: none;
    }
    .suggestion-item:hover, .suggestion-item.active {
      background: #0d6efd;
      color: white;
    }
    body.dark .suggestion-item:hover, body.dark .suggestion-item.active {
      background: #4fd1c5;
      color: #0a1128;
    }

    #results {
      margin: 40px 0;
      display: none;
      text-align: center;
    }
    #locationName {
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 600;
    }
    body.light #locationName { color: #0d6efd; }
    body.dark #locationName { color: #4fd1c5; }
    .times-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    .time-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 16px;
      text-align: center;
      transition: transform 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    body.light .time-card {
      background: white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      border: 1px solid #e0e0e0;
    }
    .time-card:hover {
      transform: translateY(-5px);
    }
    .time-card i {
      font-size: 1.6rem;
      margin-bottom: 8px;
      display: block;
    }
    .prayer-name {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 6px;
      font-family: 'Amiri', serif;
    }
    body.light .prayer-name { color: #0d6efd; }
    body.dark .prayer-name { color: #4fd1c5; }
    .prayer-time {
      font-size: 1.4rem;
      font-weight: 600;
      color: #212529;
    }
    body.dark .prayer-time { color: #e0e4f0; }
    .cta-button {
      display: block;
      margin: 50px auto;
      padding: 16px 32px;
      text-align: center;
      background: #0d6efd;
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
      border-radius: 14px;
      text-decoration: none;
      max-width: 320px;
      box-shadow: 0 6px 20px rgba(13, 110, 253, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    body.dark .cta-button {
      background: #4fd1c5;
      color: #0a1128;
      box-shadow: 0 6px 20px rgba(79, 209, 197, 0.3);
    }
    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(13, 110, 253, 0.4);
    }
    body.dark .cta-button:hover {
      box-shadow: 0 10px 25px rgba(79, 209, 197, 0.4);
    }
    footer {
      text-align: center;
      margin-top: 60px;
      color: #6c757d;
      font-size: 0.9rem;
      padding: 20px;
    }
    body.dark footer { color: #6b7a99; }
    footer a {
      color: #0d6efd;
      text-decoration: none;
      font-weight: 500;
    }
    body.dark footer a { color: #4fd1c5; }
    footer a:hover {
      text-decoration: underline;
    }
    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 480px) {
      .logo { font-size: 3rem; }
      h1 { font-size: 2rem; }
      .search-box { flex-direction: column; }
      .search-box button {
        padding: 14px;
      }
      .prayer-time { font-size: 1.3rem; }
      .times-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body class="light">
  <div class="container">
    <div id="themeToggle" class="theme-toggle">
      <i class="fas fa-sun"></i>
    </div>
    <div class="logo">
      <i class="fas fa-mosque"></i>
    </div>
    <h1>–†—É–∑–Ω–∞–º–∞</h1>
    <p class="subtitle">–í—Ä–µ–º–µ–Ω–∞ –Ω–∞–º–∞–∑–æ–≤ –æ–Ω–ª–∞–π–Ω –†–î</p>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–ª–∏ —Ä–∞–π–æ–Ω..." autocomplete="off" />
      <button onclick="searchLocation()">–ù–∞–π—Ç–∏</button>
      <div id="suggestions" class="suggestions"></div>
    </div>
    <div id="results">
      <h2 id="locationName"></h2>
      <div class="times-grid">
        <div class="time-card">
          <i class="fas fa-moon"></i>
          <div class="prayer-name">–§–∞–¥–∂—Ä</div>
          <div class="prayer-time" id="Fajr">‚Äî</div>
        </div>
        <div class="time-card">
          <i class="fas fa-sun"></i>
          <div class="prayer-name">–®—É—Ä—É–∫</div>
          <div class="prayer-time" id="Sunrise">‚Äî</div>
        </div>
        <div class="time-card">
          <i class="fas fa-sun"></i>
          <div class="prayer-name">–ó—É—Ö—Ä</div>
          <div class="prayer-time" id="Dhuhr">‚Äî</div>
        </div>
        <div class="time-card">
          <i class="fas fa-cloud-sun"></i>
          <div class="prayer-name">–ê—Å—Ä</div>
          <div class="prayer-time" id="Asr">‚Äî</div>
        </div>
        <div class="time-card">
          <i class="fas fa-sunset"></i>
          <div class="prayer-name">–ú–∞–≥—Ä–∏–±</div>
          <div class="prayer-time" id="Maghrib">‚Äî</div>
        </div>
        <div class="time-card">
          <i class="fas fa-star"></i>
          <div class="prayer-name">–ò—à–∞</div>
          <div class="prayer-time" id="Isha">‚Äî</div>
        </div>
      </div>
    </div>
    <footer>
      <p>¬© 2025 <strong>–†—É–∑–Ω–∞–º–∞</strong>. –°–æ–∑–¥–∞–Ω —Å –∏—Å–∫—Ä–µ–Ω–Ω–∏–º –Ω–∞–º–µ—Ä–µ–Ω–∏–µ–º.</p>
    </footer>
  </div>

  <script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    let citiesAreasData = { cities: [], areas: [] };
    let locations = [];
    fetch('../db/cities-areas.json')
      .then(r => r.json())
      .then(data => {
        citiesAreasData = data;
        locations = [
          ...data.cities.map(c => ({ ...c, type: 'city' })),
          ...data.areas.map(a => ({ ...a, type: 'area' }))
        ];
      })
      .catch(err => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ cities-areas.json:', err));

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    const icon = themeToggle.querySelector('i');
    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme);
    themeToggle.addEventListener('click', () => {
      const newTheme = body.classList.contains('light') ? 'dark' : 'light';
      setTheme(newTheme);
      localStorage.setItem('theme', newTheme);
    });
    function setTheme(theme) {
      body.className = theme;
      if (theme === 'light') {
        icon.className = 'fas fa-sun';
      } else {
        icon.className = 'fas fa-moon';
      }
    }

    // –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ (–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
    function fmt(time) {
      return Array.isArray(time) && time.length >= 2
        ? `${String(time[0]).padStart(2, '0')}:${String(time[1]).padStart(2, '0')}`
        : '‚Äî';
    }

    // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    const searchInput = document.getElementById('searchInput');
    const suggestionsBox = document.getElementById('suggestions');
    let suggestionItems = [];
    let activeSuggestionIndex = -1;

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π: —Å–Ω–∞—á–∞–ª–∞ –≥–¥–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ
    function showSuggestions(matches) {
      suggestionsBox.innerHTML = '';
      if (matches.length === 0) {
        suggestionsBox.style.display = 'none';
        return;
      }

      const query = searchInput.value.trim().toLowerCase();
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —á–µ–º —Ä–∞–Ω—å—à–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ ‚Äî —Ç–µ–º –≤—ã—à–µ
      matches.sort((a, b) => {
        const nameA = (a.name_cities || a.name_areas || '').toLowerCase();
        const nameB = (b.name_cities || b.name_areas || '').toLowerCase();
        return nameA.indexOf(query) - nameB.indexOf(query);
      });

      matches.forEach((loc, index) => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.textContent = loc.name_cities || loc.name_areas;
        div.dataset.index = index;
        div.addEventListener('click', () => {
          searchInput.value = div.textContent;
          suggestionsBox.style.display = 'none';
          searchLocation();
        });
        suggestionsBox.appendChild(div);
      });

      suggestionItems = Array.from(suggestionsBox.children);
      suggestionsBox.style.display = 'block';
      activeSuggestionIndex = -1;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim().toLowerCase();
      if (!query || !locations.length) {
        suggestionsBox.style.display = 'none';
        return;
      }

      const filtered = locations.filter(loc => {
        const name = (loc.name_cities || loc.name_areas || '').toLowerCase();
        return name.includes(query);
      });

      showSuggestions(filtered);
    });

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏
    searchInput.addEventListener('keydown', (e) => {
      if (!suggestionItems.length) return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        activeSuggestionIndex = (activeSuggestionIndex + 1) % suggestionItems.length;
        updateActive();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        activeSuggestionIndex = (activeSuggestionIndex - 1 + suggestionItems.length) % suggestionItems.length;
        updateActive();
      } else if (e.key === 'Enter') {
        e.preventDefault();
        if (activeSuggestionIndex >= 0) {
          searchInput.value = suggestionItems[activeSuggestionIndex].textContent;
          suggestionsBox.style.display = 'none';
          searchLocation();
        } else {
          searchLocation(); // –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ ‚Äî –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫
        }
      }
    });

    function updateActive() {
      suggestionItems.forEach((item, i) => {
        item.classList.toggle('active', i === activeSuggestionIndex);
      });
    }

    // –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
    document.addEventListener('click', (e) => {
      if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
        suggestionsBox.style.display = 'none';
      }
    });

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ (–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
    async function searchLocation() {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      const resultsDiv = document.getElementById('results');
      resultsDiv.style.display = 'none';
      if (!query) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ —Ä–∞–π–æ–Ω–∞');
      const location = locations.find(loc =>
        (loc.name_cities || loc.name_areas || '').toLowerCase().includes(query)
      );
      if (!location) return alert('–ú–µ—Å—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
      const id = location.id;
      const name = location.name_cities || location.name_areas;
      document.getElementById('locationName').textContent = name;
      resultsDiv.style.display = 'block';
      try {
        const response = await fetch(`../db/cities-areas/${id}.json`);
        if (!response.ok) throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        const data = await response.json();
        const now = new Date();
        const monthEn = now.toLocaleString('en-GB', { month: 'long' }); // –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
        const day = String(now.getDate()).padStart(2, '0');
        const monthData = data[monthEn];
        const dayData = monthData ? monthData[day] : null;
        if (!dayData) {
          alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ–≥–æ–¥–Ω—è');
          return;
        }
        document.getElementById('Fajr').textContent = fmt(dayData.Fajr);
        document.getElementById('Sunrise').textContent = fmt(dayData.Sunrise);
        document.getElementById('Dhuhr').textContent = fmt(dayData.Dhuhr);
        document.getElementById('Asr').textContent = fmt(dayData.Asr);
        document.getElementById('Maghrib').textContent = fmt(dayData.Maghrib);
        document.getElementById('Isha').textContent = fmt(dayData.Isha);
      } catch (err) {
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–º—ë–Ω –Ω–∞–º–∞–∑–æ–≤');
        console.error(err);
      }
    }

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Enter (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –Ω–æ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è)
    searchInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') {
        if (suggestionsBox.style.display === 'block' && activeSuggestionIndex >= 0) {
          return; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ keydown
        }
        searchLocation();
      }
    });
  </script>
</body>
</html>