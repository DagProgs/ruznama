<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="css/styles.css">
    <title>Рузнама - Времена намазов</title>
    <meta name="description" content="Точное время обязательных намазов:
    сегодня - месяц - год">
    <meta name="keywords" content="Рузнама, Времена намазов">
    <meta name="robots" content="index,follow,noodp">
    <meta name="googlebot" content="index,follow">
    <meta name="google" content="nositelinkssearchbox">
    <meta name="google" content="notranslate">
    <meta name="google-site-verification" content="verification_token">
    <meta name="generator" content="WEB APP">
    <meta content="Рузнама">
    <meta content="website">
	<script src="https://telegram.org/js/telegram-web-app.js "></script>
</head>

<body>

    <div class="container">
        <div id="date-info">Загрузка даты...</div>
        <div id="file-name">Файл: загрузка...</div>
        <ul class="prayer-list" id="prayer-times">
            <li style="text-align:center;">Загрузка данных...</li>
        </ul>
    </div>

    <script>
        const monthNames = [
            "января", "февраля", "марта", "апреля", "мая", "июня",
            "июля", "августа", "сентября", "октября", "ноября", "декабря"
        ];

        const dayNames = [
            "воскресенье", "понедельник", "вторник", "среда",
            "четверг", "пятница", "суббота"
        ];

        const translation = {
            "Fajr": "Фаджр",
            "Sunrise": "Шурук",
            "Dhuhr": "Зухр",
            "Asr": "Аср",
            "Maghrib": "Магриб",
            "Isha": "Иша"
        };

        const today = new Date();
        const month = today.getMonth(); // 0-based
        const day = today.getDate();

        // показываем текущую дату и день недели
        const dayName = dayNames[today.getDay()];
        document.getElementById("date-info").innerHTML = `
      Сегодня: <strong>${day} ${monthNames[month]}</strong>, ${dayName}
    `;

        const ul = document.getElementById('prayer-times');
        const fileNameDiv = document.getElementById('file-name');

        // функция для загрузки выбранного файла
        function loadPrayerTimes(fileName) {
            ul.innerHTML = "<li style='text-align:center;'>Загрузка данных...</li>";
            fetch(fileName)
                .then(response => {
                    if (!response.ok) throw new Error('Ошибка загрузки файла');
                    return response.json();
                })
                .then(data => {
                    const monthData = data[month + 1]; // в JSON месяцы с 1
                    const dayData = monthData ? monthData[day] : null;

                    ul.innerHTML = "";

                    if (dayData) {
                        const formatTime = (arr) => {
                            return `${arr[0].toString().padStart(2, '0')}:${arr[1].toString().padStart(2, '0')}`;
                        };

                        for (const [name, time] of Object.entries(dayData)) {
                            const ruName = translation[name] || name;
                            const li = document.createElement('li');
                            li.className = 'prayer-item';
                            li.innerHTML = `
                <span class="prayer-name">${ruName}</span>
                <span class="prayer-time">${formatTime(time)}</span>
              `;
                            ul.appendChild(li);
                        }
                    } else {
                        ul.innerHTML = "<li style='text-align:center;'>Данные отсутствуют</li>";
                    }
                })
                .catch(error => {
                    console.error(error);
                    ul.innerHTML = "<li style='text-align:center;'>Не удалось загрузить данные</li>";
                });
        }

        // читаем выбранный файл из localStorage и показываем
        const selectedFile = localStorage.getItem('selectedJsonFile');
        if (selectedFile) {
            loadPrayerTimes(selectedFile);
            // отображаем имя файла
            const displayName = selectedFile === '1.json' ? 'Курахский район' :
                selectedFile === '2.json' ? 'С.Стальский район' :
                    selectedFile === '3.json' ? 'Файл 3' : selectedFile;
            document.getElementById('file-name').innerText = 'Рузнама: ' + displayName;
        } else {
            ul.innerHTML = "<li style='text-align:center;'>Файл не выбран. Вернитесь на главную страницу и выберите файл.</li>";
            document.getElementById('file-name').innerText = 'Файл: не выбран';
        }
    </script>
</body>

</html>